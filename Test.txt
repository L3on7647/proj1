Sub MakePassportStyle()
    Dim sld As Slide
    Dim shp As Shape
    Dim srcTable As Table
    Dim targetSlide As Slide
    Dim targetTable As Table
    
    Dim clientName As String
    Dim carFullInfo As String
    Dim carName As String
    Dim balanceDate As String
    Dim balanceValue As String
    Dim lastCol As Integer
    
    ' 1. BELGILANGAN JADVALNI OLISH
    On Error Resume Next
    If ActiveWindow.Selection.Type <> ppSelectionShapes Then
        MsgBox "Iltimos, avval 1-rasmdagi ESKI JADVALNI tanlang!", vbExclamation
        Exit Sub
    End If
    Set shp = ActiveWindow.Selection.ShapeRange(1)
    If shp.HasTable Then
        Set srcTable = shp.Table
    Else
        MsgBox "Bu jadval emas!", vbCritical
        Exit Sub
    End If
    On Error GoTo 0
    
    ' 2. MA'LUMOTLARNI SUG'URIB OLISH
    ' Oxirgi ustunni topamiz (odatda ma'lumotlar o'ng chekkada bo'ladi)
    lastCol = srcTable.Columns.Count
    
    ' A) MIJOZ NOMI (Header yoki 1-qator)
    ' 1-rasmda ko'k fonda "RIVOJIDDINOVA G.B." turibdi. Bu odatda Cell(1,1) yoki Cell(1,2)
    clientName = CleanText(srcTable.Cell(1, 2).Shape.TextFrame.TextRange.Text)
    ' Agar bo'sh bo'lsa, 1-qator 1-katakni tekshiramiz (merged bo'lsa)
    If Len(clientName) < 3 Then clientName = CleanText(srcTable.Cell(1, 1).Shape.TextFrame.TextRange.Text)
    
    ' B) MASHINA HAQIDA (6-qator oxirgi ustun)
    carFullInfo = CleanText(srcTable.Cell(6, lastCol).Shape.TextFrame.TextRange.Text)
    
    ' C) BALANS SANASI (7-qator)
    balanceDate = CleanText(srcTable.Cell(7, lastCol).Shape.TextFrame.TextRange.Text)
    
    ' D) BALANS QIYMATI (8-qator)
    balanceValue = CleanText(srcTable.Cell(8, lastCol).Shape.TextFrame.TextRange.Text)
    
    ' E) MULK NOMI (faqat birinchi qatorni ajratib olish - "CHEVROLET COBALT")
    If InStr(carFullInfo, vbCr) > 0 Then
        carName = Split(carFullInfo, vbCr)(0)
    Else
        carName = Split(carFullInfo, " ")(0) & " " & Split(carFullInfo, " ")(1)
    End If

    ' 3. YANGI SLAYD VA DIZAYN (2-RASMDAGI KABI)
    Set targetSlide = ActivePresentation.Slides.Add(ActiveWindow.View.Slide.SlideIndex + 1, ppLayoutBlank)
    
    ' Sarlavha (Ko'k fon bilan)
    Dim titleBox As Shape
    Set titleBox = targetSlide.Shapes.AddTextbox(msoTextOrientationHorizontal, 30, 20, 650, 40)
    With titleBox
        .Fill.ForeColor.RGB = RGB(141, 180, 226) ' Och ko'k
        .TextFrame.TextRange.Text = "OBYEKT PASPORTI"
        .TextFrame.TextRange.Font.Bold = msoTrue
        .TextFrame.TextRange.ParagraphFormat.Alignment = ppAlignCenter
        .TextFrame.VerticalAnchor = msoAnchorMiddle
    End With

    ' 4. YANGI JADVAL CHIZISH
    Set shp = targetSlide.Shapes.AddTable(8, 2, 30, 70, 400, 350)
    Set targetTable = shp.Table
    
    With targetTable
        ' Ustun kengliklari
        .Columns(1).Width = 130
        .Columns(2).Width = 270
        
        ' 1-Qator: Balansda saqlovchi
        .Cell(1, 1).Shape.TextFrame.TextRange.Text = "Balansda saqlovchi"
        .Cell(1, 2).Shape.TextFrame.TextRange.Text = clientName
        .Cell(1, 2).Shape.TextFrame.TextRange.Font.Bold = msoTrue
        
        ' 2-Qator: Mulk nomi
        .Cell(2, 1).Shape.TextFrame.TextRange.Text = "Mulk nomi"
        .Cell(2, 2).Shape.TextFrame.TextRange.Text = carName
        
        ' 3-Qator: Manzili (Bo'sh qoladi, chunki 1-rasmda yo'q)
        .Cell(3, 1).Shape.TextFrame.TextRange.Text = "Manzili"
        
        ' 4-Qator: Maydoni (Bo'sh)
        .Cell(4, 1).Shape.TextFrame.TextRange.Text = "Maydoni"
        
        ' 5-Qator: Tavsifi (To'liq info shu yerga)
        .Cell(5, 1).Shape.TextFrame.TextRange.Text = "Tavsifi"
        .Cell(5, 2).Shape.TextFrame.TextRange.Text = carFullInfo
        .Cell(5, 2).Shape.TextFrame.TextRange.Font.Size = 10
        
        ' 6-Qator: Holati (Qoniqarli deb qo'yamiz standart)
        .Cell(6, 1).Shape.TextFrame.TextRange.Text = "Holati"
        .Cell(6, 2).Shape.TextFrame.TextRange.Text = "Qoniqarli"
        
        ' 7-Qator: Sana
        .Cell(7, 1).Shape.TextFrame.TextRange.Text = "Balansga olingan sana"
        .Cell(7, 2).Shape.TextFrame.TextRange.Text = balanceDate
        
        ' 8-Qator: Qiymat
        .Cell(8, 1).Shape.TextFrame.TextRange.Text = "Balans qiymati"
        .Cell(8, 2).Shape.TextFrame.TextRange.Text = balanceValue
        
        ' Dizayn berish (Chiziqlar va rang)
        .ApplyStyle "{5C22544A-7EE6-4342-B048-85BDC9FD1C3A}" 
    End With
    
    MsgBox "Tayyor! Yangi slaydga qarang.", vbInformation
End Sub

' Matnni tozalovchi funksiya
Function CleanText(txt As String) As String
    Dim temp As String
    temp = Replace(txt, Chr(13), vbCr) ' Enterlarni to'g'irlash
    temp = Replace(temp, Chr(7), "")   ' Jadval belgisini olib tashlash
    temp = Trim(temp)
    CleanText = temp
End Function
