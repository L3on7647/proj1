Sub DamasStilidaRasmlar()
    Dim srcSlide As Slide
    Dim newSlide As Slide
    Dim shp As Shape
    Dim picColl As New Collection
    Dim i As Integer
    
    ' 1. Hozirgi slaydni aniqlash
    Set srcSlide = ActiveWindow.View.Slide
    
    ' 2. Slayddagi BARCHA rasmlarni yig'ish
    ' (Bu kod slayddagi har bir burchakni tekshiradi)
    For Each shp In srcSlide.Shapes
        ' Agar oddiy rasm bo'lsa
        If shp.Type = msoPicture Or shp.Type = msoLinkedPicture Then
            picColl.Add shp
        ' Agar Placeholder ichidagi rasm bo'lsa
        ElseIf shp.Type = msoPlaceholder Then
            If shp.PlaceholderFormat.ContainedType = msoPicture Then
                picColl.Add shp
            End If
        ' Agar Rasmlar guruhlangan (Group) bo'lsa, ichiga kirib olamiz
        ElseIf shp.Type = msoGroup Then
            Dim subShp As Shape
            For Each subShp In shp.GroupItems
                If subShp.Type = msoPicture Then picColl.Add subShp
            Next subShp
        End If
    Next shp
    
    ' Agar rasm topilmasa, ogohlantiramiz
    If picColl.Count = 0 Then
        MsgBox "Diqqat! Bu slaydda birorta ham rasm topilmadi. Rasmlar rasm formatidami?", vbExclamation
        Exit Sub
    End If

    ' 3. YANGI SLAYD VA SHABLONNI CHIZISH
    Set newSlide = ActivePresentation.Slides.Add(srcSlide.SlideIndex + 1, ppLayoutBlank)
    
    ' A) Ko'k Sarlavha
    Dim titleBox As Shape
    Set titleBox = newSlide.Shapes.AddTextbox(msoTextOrientationHorizontal, 0, 20, 960, 40) ' Butun eniga
    With titleBox
        .Fill.ForeColor.RGB = RGB(180, 200, 230) ' Och ko'k fon
        .TextFrame.TextRange.Text = "OBYEKT PASPORTI" ' Sarlavha
        .TextFrame.TextRange.Font.Bold = msoTrue
        .TextFrame.TextRange.Font.Size = 24
        .TextFrame.TextRange.ParagraphFormat.Alignment = ppAlignCenter
        .TextFrame.VerticalAnchor = msoAnchorMiddle
    End With
    
    ' B) Chap tomondagi Jadval (Damas shabloniga o'xshatib)
    Dim tbl As Shape
    Set tbl = newSlide.Shapes.AddTable(8, 2, 30, 80, 450, 400)
    With tbl.Table
        .Columns(1).Width = 150
        .Columns(2).Width = 300
        ' Shablon so'zlarini yozib qo'yamiz
        .Cell(1, 1).Shape.TextFrame.TextRange.Text = "Balansda saqlovchi"
        .Cell(2, 1).Shape.TextFrame.TextRange.Text = "Mulk nomi"
        .Cell(3, 1).Shape.TextFrame.TextRange.Text = "Manzili"
        .Cell(4, 1).Shape.TextFrame.TextRange.Text = "Maydoni"
        .Cell(5, 1).Shape.TextFrame.TextRange.Text = "Tavsifi"
        .Cell(6, 1).Shape.TextFrame.TextRange.Text = "Holati"
        .Cell(7, 1).Shape.TextFrame.TextRange.Text = "Balansga olingan sana"
        .Cell(8, 1).Shape.TextFrame.TextRange.Text = "Balans qiymati"
        .ApplyStyle "{5C22544A-7EE6-4342-B048-85BDC9FD1C3A}"
    End With

    ' 4. RASMLARNI JOYLASHTIRISH (2x2 GRID)
    Dim imgW As Single, imgH As Single
    Dim startX As Single, startY As Single
    Dim gap As Single
    Dim r As Integer, c As Integer
    Dim newPic As ShapeRange
    
    ' O'ng tomon parametrlari
    startX = 500  ' Jadvaldan keyin boshlanadi
    startY = 80   ' Tepadan joy
    imgW = 220    ' Rasm kengligi
    imgH = 160    ' Rasm balandligi
    gap = 10      ' Oradagi masofa
    
    ' Har bir rasmni ko'chirib joylaymiz
    For i = 1 To picColl.Count
        If i > 4 Then Exit For ' 4 tadan ortiq bo'lsa to'xtasin (sig'maydi)
        
        picColl(i).Copy
        Set newPic = newSlide.Shapes.Paste
        
        ' Qator va Ustunni hisoblash (0 yoki 1)
        r = (i - 1) \ 2  ' 1,2 -> 0-qator; 3,4 -> 1-qator
        c = (i - 1) Mod 2 ' 1,3 -> 0-ustun; 2,4 -> 1-ustun
        
        With newPic
            .LockAspectRatio = msoTrue
            ' Enini to'g'irlaymiz
            .Width = imgW
            ' Agar bo'yi uzun bo'lib ketsa, qirqamiz (Crop)
            If .Height > imgH Then
                .PictureFormat.CropBottom = .Height - imgH
            End If
            ' Joylash
            .Left = startX + (c * (imgW + gap))
            .Top = startY + (r * (imgH + gap))
            
            ' Ramka qo'shish (Damasdagidek ko'rinishi uchun)
            .Line.Visible = msoTrue
            .Line.ForeColor.RGB = RGB(255, 255, 255)
            .Line.Weight = 2
        End With
    Next i
    
    MsgBox "Tayyor! Rasmlar o'tkazildi.", vbInformation
End Sub
