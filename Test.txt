' --- BU QISM ENG TEPADA TURISHI SHART ---
#If VBA7 Then
    Public Declare PtrSafe Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
#Else
    Public Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
#End If
' ----------------------------------------

Sub PowerPointgaPasportFinal()
    Dim pptApp As Object
    Dim pptPres As Object
    Dim pptSlide As Object
    Dim excelSheet As Worksheet
    Dim lastRow As Long, i As Long
    Dim pptPath As String
    Dim shp As Object
    Dim tbl As Object
    
    ' --- SOZLAMALAR ---
    pptPath = "C:\Users\User\Desktop\Паспорт шаблон (002) (002).pptx" 
    Set excelSheet = ThisWorkbook.Sheets("TABLE")
    ' ------------------

    ' PowerPointni ochish
    On Error Resume Next
    Set pptApp = GetObject(, "PowerPoint.Application")
    If Err.Number <> 0 Then Set pptApp = CreateObject("PowerPoint.Application")
    On Error GoTo 0
    
    pptApp.Visible = True
    Set pptPres = pptApp.Presentations.Open(pptPath)
    
    lastRow = excelSheet.Cells(excelSheet.Rows.Count, 1).End(xlUp).Row

    ' --- SIKL ---
    For i = 2 To lastRow
        
        ' 1. Slayddan nusxa olamiz
        pptPres.Slides(1).Duplicate
        
        ' Xatolikni oldini olish uchun 0.5 soniya kutamiz (Majburiy)
        DoEvents
        Sleep 500 
        
        ' Yangi slayd har doim 2-raqamda paydo bo'ladi
        Set pptSlide = pptPres.Slides(2)
        
        ' 2. Jadvalni topib to'ldiramiz
        For Each shp In pptSlide.Shapes
            If shp.HasTable Then
                Set tbl = shp.Table
                
                ' --- QATORLAR (Endi 1-qatordan boshlaymiz) ---
                
                ' Agar yana xatolik bersa, demak jadval strukturasi boshqacha. 
                ' Hozircha siz aytgandek 1 pog'ona yuqoriga surdim.
                
                ' 1. Балансда сақловчи (1-qator)
                tbl.Cell(1, 2).Shape.TextFrame.TextRange.Text = excelSheet.Cells(i, 1).Value
                
                ' 2. Мулк номи (2-qator)
                tbl.Cell(2, 2).Shape.TextFrame.TextRange.Text = excelSheet.Cells(i, 2).Value
                
                ' 3. Манзили (3-qator)
                tbl.Cell(3, 2).Shape.TextFrame.TextRange.Text = excelSheet.Cells(i, 3).Value
                
                ' 4. Майдони (4-qator)
                tbl.Cell(4, 2).Shape.TextFrame.TextRange.Text = excelSheet.Cells(i, 4).Value
                
                ' 5. Тавсифи (5-qator)
                tbl.Cell(5, 2).Shape.TextFrame.TextRange.Text = excelSheet.Cells(i, 5).Value
                
                ' 6. Коммуникация (6-qator)
                tbl.Cell(6, 2).Shape.TextFrame.TextRange.Text = excelSheet.Cells(i, 6).Value
                
                ' 7. Ҳолати (7-qator)
                tbl.Cell(7, 2).Shape.TextFrame.TextRange.Text = excelSheet.Cells(i, 7).Value
                
                ' 8. Сана (8-qator)
                tbl.Cell(8, 2).Shape.TextFrame.TextRange.Text = excelSheet.Cells(i, 8).Value
                
                ' 9. Қиймати (9-qator)
                tbl.Cell(9, 2).Shape.TextFrame.TextRange.Text = excelSheet.Cells(i, 9).Value
                
                ' 10. Шартлари (10-qator)
                tbl.Cell(10, 2).Shape.TextFrame.TextRange.Text = excelSheet.Cells(i, 10).Value
                
            End If
        Next shp
        
        ' 3. Tayyor slaydni oxiriga tashlaymiz
        pptSlide.MoveTo toPos:=pptPres.Slides.Count
        
        ' Yana ozgina kutamiz, keyingi aylanaga o'tishdan oldin
        DoEvents
        Sleep 200
        
    Next i

    MsgBox "Tayyor! Xatoliksiz tugadi.", vbInformation
End Sub
